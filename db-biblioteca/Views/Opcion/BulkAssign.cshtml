@{
    ViewData["Title"] = "Asignar Acciones de Menú Masivas";
}
 

<form method="post">
    <div class="text-danger" id="validationSummary"></div>

    <div class="form-group">
        <label class="control-label">Elemento de Menú</label>
        <select name="menuId" class="form-control">
            <option value="">-- Seleccione elemento de menú --</option>
            @foreach (var menuItem in ViewBag.OpcionItems as SelectList)
            {
                <option value="@menuItem.Value">@menuItem.Text</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label class="control-label">Rol</label>
        <select name="rolId" class="form-control">
            <option value="">-- Seleccione rol --</option>
            @foreach (var role in ViewBag.IdRol as SelectList)
            {
                <option value="@role.Value">@role.Text</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label class="control-label">Perfil</label>
        <select name="perfilId" class="form-control">
            <option value="">-- Seleccione perfil --</option>
            @foreach (var profile in ViewBag.IdPerfil as SelectList)
            {
                <option value="@profile.Value">@profile.Text</option>
            }
        </select>
    </div>

    <div class="form-group">
        <label class="control-label">Acciones Disponibles</label>
        <div class="form-check">
            <input type="checkbox" name="selectedActions" value="Crear" class="form-check-input" id="crearCheckbox" />
            <label class="form-check-label" for="crearCheckbox">Crear</label>
        </div>
        <div class="form-check">
            <input type="checkbox" name="selectedActions" value="Editar" class="form-check-input" id="editarCheckbox" />
            <label class="form-check-label" for="editarCheckbox">Editar</label>
        </div>
        <div class="form-check">
            <input type="checkbox" name="selectedActions" value="Eliminar" class="form-check-input" id="eliminarCheckbox" />
            <label class="form-check-label" for="eliminarCheckbox">Eliminar</label>
        </div>
        <div class="form-check">
            <input type="checkbox" name="selectedActions" value="Ver" class="form-check-input" id="verCheckbox" />
            <label class="form-check-label" for="verCheckbox">Ver</label>
        </div>
        <div class="form-check">
            <input type="checkbox" name="selectedActions" value="Listar" class="form-check-input" id="listarCheckbox" />
            <label class="form-check-label" for="listarCheckbox">Listar</label>
        </div>
        <div class="form-check">
            <input type="checkbox" name="selectedActions" value="Exportar" class="form-check-input" id="exportarCheckbox" />
            <label class="form-check-label" for="exportarCheckbox">Exportar</label>
        </div>
    </div>

    <div class="form-group">
        <input type="submit" value="Asignar Acciones a Menú" class="btn btn-primary" />
        <a href="@Url.Action("Index")" class="btn btn-secondary">Cancelar</a>
    </div>
</form>

@section scripts {
    <script>
        $(document).ready(function() {
            // Handle form submission via AJAX
            $(document).on('submit', 'form', function(e) {
                e.preventDefault();
                var form = $(this);
                var url = '@Url.Action("BulkAssign")';
                var method = 'POST';

                // Get form data including anti-forgery token
                var formData = new FormData(form[0]);

                $.ajax({
                    url: url,
                    type: method,
                    data: formData,
                    processData: false,
                    contentType: false,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    success: function(result) {
                        if (result.success) {
                            // Show success message
                            if (result.message) {
                                toastr.success(result.message);
                            }
                            // Redirect after delay
                            setTimeout(function() {
                                window.location.href = '@Url.Action("Index")';
                            }, 2000);
                        } else {
                            // Show validation errors
                            if (result.message) {
                                toastr.error(result.message);
                            }
                        }
                    },
                    error: function(xhr) {
                        // Handle error
                        console.log(xhr.responseText);
                        toastr.error('Error al asignar acciones de menú');
                    }
                });
            });
        });
    </script>
}