@model BibliotecaDB.Models.Compra

<div>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Detalles de la Compra</h4>
        <div class="action-buttons">
            <button type="button" class="btn btn-primary btn-sm" onclick="editCompra(@Model.Id)" title="Editar Compra">
                <i class="fas fa-edit"></i> Editar
            </button>
            <button type="button" class="btn btn-danger btn-sm" onclick="deleteCompra(@Model.Id)" title="Eliminar Compra">
                <i class="fas fa-trash"></i> Eliminar
            </button>
            <button type="button" class="btn btn-info btn-sm" onclick="viewDetalles(@Model.Id)" title="Ver Detalles de Compra">
                <i class="fas fa-list"></i> Detalles
            </button>
        </div>
    </div>
    <hr />
    <dl class="row">
        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.Usuario.NombreUsuario)
        </dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.Usuario.NombreUsuario)
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.Proveedor.Nombre)
        </dt>
        <dd class="col-sm-9">
            @if (Model.Proveedor != null)
            {
                @Html.DisplayFor(model => model.Proveedor.Nombre)
            }
            else
            {
                <span>No asignado</span>
            }
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.CondicionPago.Nombre)
        </dt>
        <dd class="col-sm-9">
            @if (Model.CondicionPago != null)
            {
                @Html.DisplayFor(model => model.CondicionPago.Nombre)
            }
            else
            {
                <span>No asignado</span>
            }
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.NumeroOrdenCompra)
        </dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.NumeroOrdenCompra)
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.FechaCompra)
        </dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.FechaCompra)
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.FechaEntrega)
        </dt>
        <dd class="col-sm-9">
            @if (Model.FechaEntrega.HasValue)
            {
                @Html.DisplayFor(model => model.FechaEntrega)
            }
            else
            {
                <span>No especificado</span>
            }
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.Total)
        </dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.Total)
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.Observaciones)
        </dt>
        <dd class="col-sm-9">
            @Html.DisplayFor(model => model.Observaciones)
        </dd>

        <dt class="col-sm-3">
            @Html.DisplayNameFor(model => model.Estado)
        </dt>
        <dd class="col-sm-9">
            <span class="badge @(Model.Estado == "Activo" ? "badge-success" : "badge-danger")">
                @Html.DisplayFor(model => model.Estado)
            </span>
        </dd>
    </dl>

    @if (Model.Detalles != null && Model.Detalles.Any())
    {
        <h5>Detalles de la Compra</h5>
        <hr />
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Producto</th>
                    <th>Descripci√≥n</th>
                    <th>Unidad</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Total Parcial</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var detalle in Model.Detalles)
                {
                    <tr>
                        <td>@(detalle.Producto?.Nombre ?? "N/A")</td>
                        <td>@detalle.Descripcion</td>
                        <td>@detalle.UnidadMedida</td>
                        <td>@detalle.CantidadSolicitada</td>
                        <td>@detalle.PrecioUnitario</td>
                        <td>@detalle.TotalParcial</td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>
<div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
</div>

<script>
    function editCompra(id) {
        // Close current modal
        $('.modal').modal('hide');

        // Load edit form via AJAX
        $.get('/Compras/Edit/' + id, function(data) {
            $('#editModalContent').html(data);
            $('#editModal').modal('show');
        });
    }

    function deleteCompra(id) {
        // Close current modal
        $('.modal').modal('hide');

        // Load delete confirmation via AJAX
        $.get('/Compras/Delete/' + id, function(data) {
            $('#deleteModalContent').html(data);
            $('#deleteModal').modal('show');
        });
    }

    function viewDetalles(id) {
        // Redirect to compra detalles page
        window.location.href = '/CompraDetalles/Index?idCompra=' + id;
    }
</script>